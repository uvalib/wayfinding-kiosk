<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<dom-module id="my-list">
  <style>
    :host {
      display: block;
    }

    /deep/ .v-grid paper-material {
      
      /*
      @apply(--layout-flex);
       @apply(--layout-wrap); 
      overflow:auto;
      height:90%;
      white-space: pre-wrap;
      */
      padding: 0px !important;
      height: 90% !important;

      overflow: auto !important;
      white-space: nowrap !important;
      display: inline-block !important;
      position: relative !important;
      background-color: white !important;
      width: 0 !important;
      margin: 8px !important;
      border-radius: 2px !important;
      font-weight: 300 !important;
      cursor: default !important;
      vertical-align: top !important;
      
      -webkit-user-select: none !important;
      -moz-user-select: none !important;
      -ms-user-select: none !important;
      -webkit-flex: 1 !important;
      -ms-flex: 1 !important;
      flex: 1 !important;
      
      cursor: pointer !important;
    }

    /deep/ .v-grid paper-material .image-wrapper {
      padding-top: 100%;
      border-radius: 2px 2px 0 0;
      position: relative;
      cursor: pointer;
      width: 100%;
    }

    /deep/ .v-grid paper-material .image-inner-wrapper {
      position: absolute;
      top: 0;
      border-radius: 2px 2px 0 0;
      width: 100%;
      height: 100%;
    }

    /deep/ .v-grid paper-material .image-inner-wrapper img {
      width: 100%;
    }

    /deep/ .v-grid .fade-out {
      position: relative;
      white-space: nowrap;
    }
    
    /deep/ .v-grid .fade-out:after {
    display: block;
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: 30px;
    content: "";
    background-image: -webkit-gradient(linear,left top,right top,color-stop(0%,rgba(255,255,255,0)),color-stop(100%,rgba(255,255,255,1)));
    background-image: -webkit-linear-gradient(left,rgba(255,255,255,0),rgba(255,255,255,1));
    background-image: -moz-linear-gradient(left,rgba(255,255,255,0),rgba(255,255,255,1));
    background-image: -ms-linear-gradient(left,rgba(255,255,255,0),rgba(255,255,255,1));
    background-image: -o-linear-gradient(left,rgba(255,255,255,0),rgba(255,255,255,1));
    background: linear-gradient(to right,rgba(255,255,255,0),rgba(255,255,255,1));
    filter: progid:DXImageTransform.Microsoft.gradient(GradientType=1,StartColorStr='#00ffffff',EndColorStr='#ffffff');
}
    
    /deep/ tr {
      height:220px !important;
    }

    /deep/ .v-grid {
      height:30000px !important;
    }

    /deep/ .v-grid-cell, /deep/ .v-grid-row {
      height: 300px !important;
      background-color: inherit !important;
    }

    /deep/ .v-grid:focus {
      outline:none !important;
    }
  </style>
  <template>
    <uvalib-catalog id="catalog" auto availability directions items="{{items}}" facets="{{facets}}" count="{{count}}" query="{{query}}" page="{{page}}" per-page="30" sort-order="{{sort}}" facet-limits-inc='{"library":"Alderman","format":["Visual Materials","Video Quadraplex","Video Other","VHS","Thesis/Dissertation","Physical Object","Periodical","Other Media","Newspaper","Musical Score","Mixed Materials","Microform","Map","Manuscript","LP","Looseleaf","Large Print","Journal/Magazine","Government Document","Globe","Filmstrip","Film","Equipment","DVD","Computer Resource","Computer Media","CD","Broadside","Braille","Book","Blu-Ray","Atlas","Archive"]}' more="{{more}}" on-uvalib-catalog-fetched-results="catalog_fetched"></uvalib-catalog>
    
    <div class="header">
      <h2 class="title">Recently added <span>{{query}}</span></h2>
    </div>
    
<v-grid id="grid">
  <table>
    <colgroup>
      <template is="dom-repeat" items="{{cols}}">
        <col width="220">
      </template>
    </colgroup>
  </table>
</v-grid>
<!--    
    <v-grid id="grid">
        <table>
          <colgroup>
            <col width="220">
            <col width="220">
            <col width="220">
            <col width="220">
            <col width="220">
-->
          <!--
            <template is="dom-repeat" items="{{cols}}">
              <col width="220">
            </template>
          -->
<!--          </colgroup> -->
<!--
          <tbody>
          <template is="dom-repeat" items="{{rows}}">
            <tr style="height:220px">
              <template is="dom-repeat" items="{{item}}">
              <td>
                <paper-material elevation="1">
                  <div class="image-wrapper">
                    <div class="image-inner-wrapper"><img class="image" src="{{item.cover_image_url}}" alt=""></div>
                  </div>
                  <div class="details">
                    <div class="details-inner">
                      <a class="title fade-out tooltip " href="">{{item.title}}</a>
                      <a class="sub-title fade-out tooltip ">{{item.subtitle}}</a>
                    </div>
                  </div>
                </paper-material>
              </td>
              </template>
            </tr>
          </template>
          </tbody>
-->
<!--
        </table>
      </v-grid>
-->
<!--    <ul>
      <template is="dom-repeat" items="{{items}}">
        <li><span class="paper-font-body1">{{item}}</span></li>
      </template>
    </ul> -->
  </template>

  <script>
    (function () {
      Polymer({
        is: 'my-list',
        properties: {
          items: {
            type: Array,
            notify: true,
          },
          formattedItems: {
            type: Array
          },
          query: {
            type: String,
            value: "",
            observer: "queryChanged"
          },
//          facet_limits_inc: {
//            type: Object,
//            default: {
//              library: "Alderman",
//              format: [
//                "Visual Materials","Video Quadraplex","Video Other","VHS","Thesis/Dissertation",
//                "Physical Object","Periodical","Other Media","Newspaper","Musical Score",
//                "Mixed Materials","Microform","Map","Manuscript","LP","Looseleaf","Large Print",
//                "Journal/Magazine","Government Document","Globe","Filmstrip","Film","Equipment",
//                "DVD","Computer Resource","Computer Media","CD","Broadside","Braille","Book",
//                "Blu-Ray","Atlas","Archive"
//              ]
//            }
//          }
        },
        attached: function(){
          this.$.grid.header.hidden=true;
          this.$.grid.selection.mode="disabled";
        },
        ready: function() {
          this.colCount=7;
          this.cols=new Array(this.colCount);
          this.rows = []; //[[{title:"foo"},{title:"bar"},{title:"baz"},{title:"foobar"},{title:"foobaz"}],
//              [{title:"foo"},{title:"bar"},{title:"baz"},{title:"foobar"},{title:"foobaz"}],
//              [{title:"foo"},{title:"bar"},{title:"baz"},{title:"foobar"},{title:"foobaz"}]];
//          var grid = document.querySelector('v-grid');
//          grid.header.hidden=true;
//          grid.addEventListener('select', function(){
//            alert('selected grid row!');
//          });
/*
          this.items = [
            'Responsive Web App boilerplate',
            'Iron Elements and Paper Elements',
            'End-to-end Build Tooling (including Vulcanize)',
            'Unit testing with Web Component Tester',
            'Routing with Page.js',
            'Offline support with the Platinum Service Worker Elements'
          ];
*/
        },
        queryChanged: function(){
          this.rows=[];
        },
//        rows:[[{title:"foo"},{title:"bar"},{title:"baz"},{title:"foobar"},{title:"foobaz"}],
//              [{title:"foo"},{title:"bar"},{title:"baz"},{title:"foobar"},{title:"foobaz"}],
//              [{title:"foo"},{title:"bar"},{title:"baz"},{title:"foobar"},{title:"foobaz"}]],
        catalog_fetched: function(){
          this.$.catalog.parseAvailbility("Alderman");
          for(var i=0,c; (c=i*this.colCount)>=0 && c<this.items.length; i++) {
            this.rows.push(this.items.slice(c,c+this.colCount));
          }


//this.$.grid.data.source = [ { projectName: "Project A", cost: {estimate: 10000, current: 8000 } },
//             { projectName: "Project B", cost: {estimate: 20000, current: 11000 } },
//             { projectName: "Project C", cost: {estimate: 15000, current: 1000 } } ];
var renderer = function(cell) { 
  cell.element.innerHTML="";
  var paper = document.createElement("paper-material");
  paper.setAttribute("elevation",1);
  paper.setAttribute("class","stlye-scope");
  var imgWrp = document.createElement("div");
  imgWrp.setAttribute("class","image-wrapper");
  var imgInWrp = document.createElement("div");
  imgInWrp.setAttribute("class","image-inner-wrapper");
  var img = document.createElement("img");
  img.setAttribute("src",cell.data.cover_image_url)
  imgInWrp.appendChild(img);
  imgWrp.appendChild(imgInWrp);
  paper.appendChild(imgWrp);
  cell.element.appendChild(paper); 
};

//<paper-material elevation="1">
//                  <div class="image-wrapper">
//                    <div class="image-inner-wrapper"><img class="image" src="{{item.cover_image_url}}" alt=""></div>
//                  </div>
//                  <div class="details">
//                    <div class="details-inner">
//                      <a class="title fade-out tooltip " href="">{{item.title}}</a>
//                      <a class="sub-title fade-out tooltip ">{{item.subtitle}}</a>
//                    </div>
//                  </div>
//                </paper-material>


for (var i=0; i<this.colCount; i++) {
  this.$.grid.columns[i].renderer = renderer;
}
this.$.grid.data.source = this.rows;


//          this.$.grid.data.source = this.rows;
//          this.$.grid.columns[0].renderer = function(cell) {
//            cell.element.innerHTML = "<div>Hello</div>";
            //var img = document.createElement("img");
            //img.style.width = "24px";
            //img.setAttribute("src", cell.data);
            //cell.element.appendChild(img);
//          }
        }
      });
    })();
  </script>

</dom-module>
