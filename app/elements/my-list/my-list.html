<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<dom-module id="my-list">
  <style>
    :host {
      display: block;
    }

    paper-material {
      
      padding: 0px !important;
      height: 90% !important;

      overflow: hidden !important;
      white-space: nowrap !important;
      display: inline-block !important;
      position: relative !important;
      background-color: white !important;
      width: 0 !important;
      margin: 8px !important;
      border-radius: 2px !important;
      font-weight: 300 !important;
      cursor: default !important;
      vertical-align: top !important;
      
      -webkit-user-select: none !important;
      -moz-user-select: none !important;
      -ms-user-select: none !important;
      -webkit-flex: 1 !important;
      -ms-flex: 1 !important;
      flex: 1 !important;
      
      cursor: pointer !important;

      max-width: 300px;
    }

    paper-material.out {
      opacity: .3;
    }

    .row {
      @apply(--layout-horizontal);
    }

    paper-material .image-wrapper {
      padding-top: 100%;
      border-radius: 2px 2px 0 0;
      position: relative;
      cursor: pointer;
      width: 100%;
    }

    paper-material .image-inner-wrapper {
      position: absolute;
      top: 0;
      border-radius: 2px 2px 0 0;
      width: 100%;
      height: 100%;
    }

    paper-material .image-inner-wrapper img {
      width: 100%;
    }

    paper-material .details {
      padding: 16px;
      position: relative;
      background-color: white;
      height: 85px;
    }

    paper-material .details-inner {
      display: -webkit-flex;
      display: -ms-flexbox;
      display: flex;
      -ms-flex-wrap: wrap;
      -webkit-flex-wrap: wrap;
      flex-wrap: wrap;
      position: relative;
      -webkit-flex: 1;
      -ms-flex: 1;
      flex: 1;
    }

    paper-material .title {
      display: block;
      overflow: hidden;
      white-space: nowrap;
      font-size: 15px;
      line-height: 18px;
      font-weight: 400;
      color: #212121;
      text-decoration: none;
      cursor: pointer;
      outline: none;
      width: 0px;
      -webkit-flex: 1 1 100%;
      -ms-flex: 1 1 100%;
      flex: 1 1 100%;
    }

    paper-material .sub-title {
      display: block;
      overflow: hidden;
      white-space: nowrap;
      font-size: 13px;
      line-height: 16px;
      height: 16px;
      font-weight: 400;
      color: #616161;
      margin-top: 4px;
      text-decoration: none;
      outline: none;
      width: 0px;
      -webkit-flex: 1 1 100%;
      -ms-flex: 1 1 100%;
      flex: 1 1 100%;
    }

    paper-material .format {
      display: block;
      overflow: hidden;
      white-space: nowrap;
      font-size: 10px;
      line-height: 16px;
      height: 16px;
      font-weight: 400;
      color: #616161;
      margin-top: 4px;
      text-decoration: none;
      outline: none;
      width: 0px;
      -webkit-flex: 1 1 100%;
      -ms-flex: 1 1 100%;
      flex: 1 1 100%;
    }

    paper-material .author {
      display: block;
      overflow: hidden;
      white-space: nowrap;
      font-size: 10px;
      line-height: 16px;
      height: 16px;
      font-weight: 400;
      color: #616161;
      margin-top: 4px;
      text-decoration: none;
      outline: none;
      width: 0px;
      -webkit-flex: 1 1 100%;
      -ms-flex: 1 1 100%;
      flex: 1 1 100%;
    }

    .fade-out {
      position: relative;
      white-space: nowrap;
    }
    
    .fade-out:after {
      display: block;
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      width: 30px;
      content: "";
      background-image: -webkit-gradient(linear,left top,right top,color-stop(0%,rgba(255,255,255,0)),color-stop(100%,rgba(255,255,255,1)));
      background-image: -webkit-linear-gradient(left,rgba(255,255,255,0),rgba(255,255,255,1));
      background-image: -moz-linear-gradient(left,rgba(255,255,255,0),rgba(255,255,255,1));
      background-image: -ms-linear-gradient(left,rgba(255,255,255,0),rgba(255,255,255,1));
      background-image: -o-linear-gradient(left,rgba(255,255,255,0),rgba(255,255,255,1));
      background: linear-gradient(to right,rgba(255,255,255,0),rgba(255,255,255,1));
      filter: progid:DXImageTransform.Microsoft.gradient(GradientType=1,StartColorStr='#00ffffff',EndColorStr='#ffffff');
    }
    
  </style>
  <template>
    <uvalib-catalog id="catalog" auto availability directions items="{{items}}" facets="{{facets}}" count="{{count}}" query="{{query}}" page="{{page}}" per-page="27" sort-order="{{sort}}" facet-limits-inc='{"library":"Alderman","format":["Visual Materials","Video Quadraplex","Video Other","VHS","Thesis/Dissertation","Physical Object","Periodical","Other Media","Newspaper","Musical Score","Mixed Materials","Microform","Map","Manuscript","LP","Looseleaf","Large Print","Journal/Magazine","Government Document","Globe","Filmstrip","Film","Equipment","DVD","Computer Resource","Computer Media","CD","Broadside","Braille","Book","Blu-Ray","Atlas","Archive"]}' search-timeout="1500" more="{{more}}" on-uvalib-catalog-fetched-results="catalogFetched"></uvalib-catalog>
    
    <template is="dom-repeat" items="{{rows}}" as="row">
            <div class="row">
              <template is="dom-repeat" items="{{row}}" as="item">
                  <paper-material on-tap="getDirections" class$="{{itemAvailableClass(item.available)}}" elevation="1">
                    <div class="image-wrapper">
                      <div class="image-inner-wrapper">
                        <img src="{{item.cover_image_url}}"/>
                      </div>
                    </div>
                    <div class="details">
                      <div class="details-inner">
                        <div class="title fade-out">{{item.title.0}}</div>
                        <template is="dom-if" if="{{item.subtitle}}">
                          <div class="sub-title fade-out">{{item.subtitle.0}}</div>
                        </template>
                        <div class="format fade-out">
                          <span>{{item.format.0}}</span> - <span>{{item.published_date.0}}</span>
                        </div>
                        <template is="dom-if" if="item.author">
                          <div class="author fade-out">{{item.author.0}}</div>
                        </template>
                        <div class="callNum">{{item.call_number.0}}</div>
                      </div>
                    </div>
                  </paper-material>
                  
              </template>

              <template is="dom-if" if="{{isEnd(index,rows)}}">
                  <paper-material elevation="1">
                    <div class="more">More Results</div>
                  </paper-material>
              </template>

            </div>
    </template>
  </template>

  <script>

    (function () {
      Polymer({
        is: 'my-list',
        properties: {
          items: {
            type: Array,
            notify: true,
          },
          formattedItems: {
            type: Array
          },
          query: {
            type: String,
            value: '',
            observer: 'queryChanged'
          },
          selectedItem: {
            type: Object,
            notify: true
          }
        },
        isEnd: function(index, arr) {
          return (index === arr.length-1);
        },
        itemAvailableClass: function(available) {
          if (available) { return 'in'; }
          else { return 'out'; }
        },
        ready: function() {
          this.colCount=7;
          this.cols=new Array(this.colCount);
          this.rows = [];
        },
        queryChanged: function(){
          this.rows=[];
        },
        getDirections: function(e){
          this.selectedItem = e.model.get('item');
          if (this.selectedItem.available) {
            this.fire('item-selected');
          }
        },
        catalogFetched: function(){
          this.$.catalog.parseAvailbility('Alderman');
          for(var i=0,c; (c=i*this.colCount)>=0 && this.items && c<this.items.length; i++) {
            this.push('rows', this.items.slice(c,c+this.colCount));
          }
        }
      });
    })();
  </script>

</dom-module>
